<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}WealthWise{% endblock %}</title>
    
    <!-- Open Graph Metadata -->
    <meta property="og:title" content="WealthWise - Finance Management System">
    <meta property="og:description" content="Smart finance management for students and everyone! Track expenses, manage income, get AI-powered advice, and visualize spending patterns with WealthWise.">
    <meta property="og:image" content="https://wealthwise-0y3c.onrender.com/static/assets/logowhite.png">
    <meta property="og:image:width" content="600">
    <meta property="og:image:height" content="600">
    <meta property="og:image:alt" content="WealthWise Logo - Personal Finance Management">
    <meta property="og:url" content="https://wealthwise-0y3c.onrender.com">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="WealthWise">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="WealthWise - Perfect for students and anyone wanting to manage finances smartly. Track expenses, income, get AI advice, and generate detailed financial reports.">
    <meta name="keywords" content="personal finance management, expense tracker, student budget, AI financial advice, financial data visualization">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='assets/logowhite.png') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="wrapper">
        <aside id="sidebar">
            <div class="h-100">
                <div class="sidebar-logo">
                    <a href="{{ url_for('dashboard', user_id=user.id) }}">
                        <img src="{{ url_for('static', filename='assets/logon.png') }}" alt="logo" class="w-75" style="border-radius: 1rem 0 0 1rem;" />
                    </a>   
                </div>
                <ul class="sidebar-nav">
                    <li class="sidebar-header">User Control Panel</li>
                    <li class="sidebar-item">
                        <a href="{{ url_for('dashboard', user_id=user['id']) }}" class="sidebar-link">
                            <i class="bi bi-speedometer2"></i>
                            Dashboard
                        </a>
                    </li>
                    <li class="sidebar-item">
                        <a href="#" class="sidebar-link collapsed" data-bs-target="#transactions" data-bs-toggle="collapse" aria-expanded="false">
                            <i class="bi bi-coin"></i>
                            Transactions
                        </a>
                        <ul id="transactions" class="sidebar-dropdown list-unstyled collapse" data-bs-parent="#sidebar">
                            <li class="sidebar-item">
                                <a href="{{ url_for('add_income', user_id=user['id']) }}" class="sidebar-link">Add Income</a>
                            </li>
                            <li class="sidebar-item">
                                <a href="{{ url_for('add_expense', user_id=user['id']) }}" class="sidebar-link">Add Expenses/Savings</a>
                            </li>
                            <li class="sidebar-item">
                                <a href="{{ url_for('view_reports', user_id=user['id']) }}" class="sidebar-link">View Reports</a>
                            </li>
                        </ul>
                    </li>
                    <li class="sidebar-item">
                        <a href="{{ url_for('chatbot', user_id=user.id) }}" class="sidebar-link">
                            <i class="bi bi-robot"></i>
                            Chatbot
                        </a>
                    </li>
                    <li class="sidebar-item">
                        <a href="{{ url_for('visualize', user_id=user['id']) }}" class="sidebar-link">
                            <i class="bi bi-bar-chart"></i>
                            Generate Reports
                        </a>
                    </li>
                    <li class="sidebar-item">
                        <a href="{{ url_for('logout') }}" class="sidebar-link">
                            <i class="bi bi-box-arrow-left"></i>
                            Logout
                        </a>
                    </li>
                </ul>
            </div>
        </aside>
        
        <div class="main">
            <nav class="navbar navbar-expand px-3 border-bottom">
                <button class="btn" id="sidebar-toggle" type="button">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="navbar-collapse navbar">
                    <ul class="navbar-nav">
                        <li class="nav-item dropdown">
                            <a href="#" class="theme-toggle">
                                <i class="bi bi-brightness-low"></i>
                                <i class="bi bi-moon-fill"></i>
                            </a>
                        </li>
                       <li class="nav-item dropdown">
                            <a href="#" data-bs-toggle="dropdown" class="nav-icon pe-md-0">
                                <img src="{{ url_for('static', filename='assets/profile.jpg') }}" class="avatar img-fluid round" alt="Profilepic">
                            </a>
                            <div class="dropdown-menu dropdown-menu-end">
                                <a href="#" class="dropdown-item" id="toggle-2fa" data-user-id="{{ user['id'] }}" data-use-otp="{{ 'true' if user['use_otp'] else 'false' }}">
                                    <i class="bi bi-shield-lock"></i> 
                                    {{ 'Disable 2FA' if user['use_otp'] else 'Enable 2FA' }}
                                </a>
                                <a href="{{ url_for('logout') }}" class="dropdown-item">Logout</a>
                            </div>
                        </li>
                    </ul>
                </div>
            </nav>
            
            <main class="content px-3 py-2">
                <div class="container">
                    <div class="mb-3 text-center">
                        <h3 class="welcome-text mb-0">Welcome, {{ user['full_name'] }}</h3>
                    </div>
                    <!-- Flash Messages -->
                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}
                    <!-- Main content block -->
                    {% block main_content %}
                    {% endblock %}
                </div>
            </main>
            
            <footer class="footer mt-auto py-3 bg-dark border-top">
                <div class="container text-center">
                    <span class="text-light">Â© 2025 WealthWise. Developed by <strong>Kaushal</strong></span>
                </div>
            </footer>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-HjW8v0j/fcO5z3XqI2q3Xv7lX5u5f7f5g5h5i5j5k5l5m5n5o5p5q5r5s5t5u5v5w5x5y5z" crossorigin="anonymous"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const toggle2faButton = document.getElementById('toggle-2fa');
        if (toggle2faButton) {
            toggle2faButton.addEventListener('click', function(e) {
                e.preventDefault();
                const userId = this.getAttribute('data-user-id');
                const currentStatus = this.getAttribute('data-use-otp') === 'true';
                fetch(`/toggle_otp/${userId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-Token': '{{ form.csrf_token._value() if form else "" }}'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        this.textContent = data.use_otp ? 'Disable 2FA' : 'Enable 2FA';
                        this.setAttribute('data-use-otp', data.use_otp);
                        this.classList.remove('btn-success', 'btn-warning');
                        this.classList.add('btn-' + (data.use_otp ? 'success' : 'warning'));
                        alert(`2FA has been ${data.use_otp ? 'enabled' : 'disabled'} successfully!`);
                    } else {
                        alert(data.message || 'Error toggling 2FA');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error toggling 2FA');
                });
            });
        }
    });

    </script>
    {% block scripts %}
    {% endblock %}
</body>
</html>